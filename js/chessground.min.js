!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Chessground=e()}}(function(){return function e(t,r,n){function o(a,s){if(!r[a]){if(!t[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(i)return i(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var l=r[a]={exports:{}};t[a][0].call(l.exports,function(e){var r=t[a][1][e];return o(r||e)},l,l.exports,e,t,r,n)}return r[a].exports}for(var i="function"==typeof require&&require,a=0;a<n.length;a++)o(n[a]);return o}({1:[function(e,t,r){"use strict";function n(e,t){var r=e(t);return t.dom.redraw(),r}function o(e,t){return{key:e,pos:c.key2pos(e),piece:t}}function i(e,t){var r=e.animation.current;if(void 0!==r){var n=1-(t-r.start)*r.frequency;if(n<=0)e.animation.current=void 0,e.dom.redrawNow();else{var o=function(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1}(n);for(var a in r.plan.anims){var s=r.plan.anims[a];s[2]=s[0]*o,s[3]=s[1]*o}e.dom.redrawNow(!0),c.raf(function(t){return void 0===t&&(t=u.now()),i(e,t)})}}else e.dom.destroyed||e.dom.redrawNow()}function a(e){for(var t in e)return!1;return!0}var s=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e};Object.defineProperty(r,"__esModule",{value:!0});var c=e("./util");r.anim=function(e,t){return t.animation.enabled?function(e,t){var r=s({},t.pieces),n=e(t),l=function(e,t){var r,n,i,a,s={},u=[],l={},d=[],f=[],p={};for(i in e)p[i]=o(i,e[i]);for(var v=0,g=c.allKeys;v<g.length;v++){var h=g[v];r=t.pieces[h],n=p[h],r?n?c.samePiece(r,n.piece)||(d.push(n),f.push(o(h,r))):f.push(o(h,r)):n&&d.push(n)}return f.forEach(function(e){(n=function(t,r){return d.filter(function(t){return c.samePiece(e.piece,t.piece)}).sort(function(e,r){return c.distanceSq(t.pos,e.pos)-c.distanceSq(t.pos,r.pos)})[0]}(e))&&(a=[n.pos[0]-e.pos[0],n.pos[1]-e.pos[1]],s[e.key]=a.concat(a),u.push(n.key))}),d.forEach(function(e){c.containsX(u,e.key)||t.items&&t.items(e.pos,e.key)||(l[e.key]=e.piece)}),{anims:s,fadings:l}}(r,t);if(a(l.anims)&&a(l.fadings))t.dom.redraw();else{var d=t.animation.current&&t.animation.current.start;t.animation.current={start:u.now(),frequency:1/t.animation.duration,plan:l},d||i(t,u.now())}return n}(e,t):n(e,t)},r.render=n;var u=void 0!==window.performance?window.performance:Date},{"./util":17}],2:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("./board"),o=e("./fen"),i=e("./config"),a=e("./anim"),s=e("./drag"),c=e("./explosion");r.start=function(e,t){function r(){n.toggleOrientation(e),t()}return{set:function(t){t.orientation&&t.orientation!==e.orientation&&r(),(t.fen?a.anim:a.render)(function(e){return i.configure(e,t)},e)},state:e,getFen:function(){return o.write(e.pieces)},toggleOrientation:r,setPieces:function(t){a.anim(function(e){return n.setPieces(e,t)},e)},selectSquare:function(t,r){t?a.anim(function(e){return n.selectSquare(e,t,r)},e):e.selected&&(n.unselect(e),e.dom.redraw())},move:function(t,r){a.anim(function(e){return n.baseMove(e,t,r)},e)},newPiece:function(t,r){a.anim(function(e){return n.baseNewPiece(e,t,r)},e)},playPremove:function(){if(e.premovable.current){if(a.anim(n.playPremove,e))return!0;e.dom.redraw()}return!1},playPredrop:function(t){if(e.predroppable.current){var r=n.playPredrop(e,t);return e.dom.redraw(),r}return!1},cancelPremove:function(){a.render(n.unsetPremove,e)},cancelPredrop:function(){a.render(n.unsetPredrop,e)},cancelMove:function(){a.render(function(e){n.cancelMove(e),s.cancel(e)},e)},stop:function(){a.render(function(e){n.stop(e),s.cancel(e)},e)},explode:function(t){c.default(e,t)},setAutoShapes:function(t){a.render(function(e){return e.drawable.autoShapes=t},e)},setShapes:function(t){a.render(function(e){return e.drawable.shapes=t},e)},getKeyAtDomPos:function(t){return n.getKeyAtDomPos(t,"white"===e.orientation,e.dom.bounds())},redrawAll:t,dragNewPiece:function(t,r,n){s.dragNewPiece(e,t,r,n)},destroy:function(){n.stop(e),e.dom.unbind&&e.dom.unbind(),e.dom.destroyed=!0}}}},{"./anim":1,"./board":3,"./config":5,"./drag":6,"./explosion":9,"./fen":10}],3:[function(e,t,r){"use strict";function n(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];e&&setTimeout(function(){return e.apply(void 0,t)},1)}function o(e){e.premovable.current&&(e.premovable.current=void 0,n(e.premovable.events.unset))}function i(e){var t=e.predroppable;t.current&&(t.current=void 0,n(t.events.unset))}function a(e,t,r){if(t===r||!e.pieces[t])return!1;var o=e.pieces[r]&&e.pieces[r].color!==e.pieces[t].color?e.pieces[r]:void 0;return r==e.selected&&d(e),n(e.events.move,t,r,o),function(e,t,r){if(!e.autoCastle)return!1;var n=e.pieces[t];if("king"!==n.role)return!1;var o=h.key2pos(t);if(5!==o[0])return!1;if(1!==o[1]&&8!==o[1])return!1;var i,a,s,c=h.key2pos(r);if(7===c[0]||8===c[0])i=h.pos2key([8,o[1]]),a=h.pos2key([6,o[1]]),s=h.pos2key([7,o[1]]);else{if(3!==c[0]&&1!==c[0])return!1;i=h.pos2key([1,o[1]]),a=h.pos2key([4,o[1]]),s=h.pos2key([3,o[1]])}var u=e.pieces[i];return"rook"===u.role&&(delete e.pieces[t],delete e.pieces[i],e.pieces[s]=n,e.pieces[a]=u,!0)}(e,t,r)||(e.pieces[r]=e.pieces[t],delete e.pieces[t]),e.lastMove=[t,r],e.check=void 0,n(e.events.change),o||!0}function s(e,t,r,o){if(e.pieces[r]){if(!o)return!1;delete e.pieces[r]}return n(e.events.dropNewPiece,t,r),e.pieces[r]=t,e.lastMove=[r],e.check=void 0,n(e.events.change),e.movable.dests=void 0,e.turnColor=h.opposite(e.turnColor),!0}function c(e,t,r){var n=a(e,t,r);return n&&(e.movable.dests=void 0,e.turnColor=h.opposite(e.turnColor),e.animation.current=void 0),n}function u(e,t,r){if(p(e,t,r)){var o=c(e,t,r);if(o){var a=e.hold.stop();d(e);var s={premove:!1,ctrlKey:e.stats.ctrlKey,holdTime:a};return!0!==o&&(s.captured=o),n(e.movable.events.after,t,r,s),!0}}else!function(e,t,r){return t!==r&&v(e,t)&&h.containsX(b.default(e.pieces,t,e.premovable.castle),r)}(e,t,r)?f(e,r)||v(e,r)?(l(e,r),e.hold.start()):d(e):(!function(e,t,r,o){i(e),e.premovable.current=[t,r],n(e.premovable.events.set,t,r,o)}(e,t,r,{ctrlKey:e.stats.ctrlKey}),d(e));return!1}function l(e,t){e.selected=t,v(e,t)?e.premovable.dests=b.default(e.pieces,t,e.premovable.castle):e.premovable.dests=void 0}function d(e){e.selected=void 0,e.premovable.dests=void 0,e.hold.cancel()}function f(e,t){var r=e.pieces[t];return r&&("both"===e.movable.color||e.movable.color===r.color&&e.turnColor===r.color)}function p(e,t,r){return t!==r&&f(e,t)&&(e.movable.free||!!e.movable.dests&&h.containsX(e.movable.dests[t],r))}function v(e,t){var r=e.pieces[t];return r&&e.premovable.enabled&&e.movable.color===r.color&&e.turnColor!==r.color}function g(e){o(e),i(e),d(e)}Object.defineProperty(r,"__esModule",{value:!0});var h=e("./util"),b=e("./premove");r.callUserFunction=n,r.toggleOrientation=function(e){e.orientation=h.opposite(e.orientation),e.animation.current=e.draggable.current=e.selected=void 0},r.reset=function(e){e.lastMove=void 0,d(e),o(e),i(e)},r.setPieces=function(e,t){for(var r in t){var n=t[r];n?e.pieces[r]=n:delete e.pieces[r]}},r.setCheck=function(e,t){if(!0===t&&(t=e.turnColor),t)for(var r in e.pieces)"king"===e.pieces[r].role&&e.pieces[r].color===t&&(e.check=r);else e.check=void 0},r.unsetPremove=o,r.unsetPredrop=i,r.baseMove=a,r.baseNewPiece=s,r.userMove=u,r.dropNewPiece=function(e,t,r,a){if(function(e,t,r){var n=e.pieces[t];return n&&r&&(t===r||!e.pieces[r])&&("both"===e.movable.color||e.movable.color===n.color&&e.turnColor===n.color)}(e,t,r)||a){var c=e.pieces[t];delete e.pieces[t],s(e,c,r,a),n(e.movable.events.afterNewPiece,c.role,r,{predrop:!1})}else!function(e,t,r){var n=e.pieces[t];return n&&r&&(!e.pieces[r]||e.pieces[r].color!==e.movable.color)&&e.predroppable.enabled&&("pawn"!==n.role||"1"!==r[1]&&"8"!==r[1])&&e.movable.color===n.color&&e.turnColor!==n.color}(e,t,r)?(o(e),i(e)):function(e,t,r){o(e),e.predroppable.current={role:t,key:r},n(e.predroppable.events.set,t,r)}(e,e.pieces[t].role,r);delete e.pieces[t],d(e)},r.selectSquare=function(e,t,r){e.selected?e.selected!==t||e.draggable.enabled?(e.selectable.enabled||r)&&e.selected!==t?u(e,e.selected,t)&&(e.stats.dragged=!1):e.hold.start():(d(e),e.hold.cancel()):(f(e,t)||v(e,t))&&(l(e,t),e.hold.start()),n(e.events.select,t)},r.setSelected=l,r.unselect=d,r.canMove=p,r.isDraggable=function(e,t){var r=e.pieces[t];return r&&e.draggable.enabled&&("both"===e.movable.color||e.movable.color===r.color&&(e.turnColor===r.color||e.premovable.enabled))},r.playPremove=function(e){var t=e.premovable.current;if(!t)return!1;var r=t[0],i=t[1],a=!1;if(p(e,r,i)){var s=c(e,r,i);if(s){var u={premove:!0};!0!==s&&(u.captured=s),n(e.movable.events.after,r,i,u),a=!0}}return o(e),a},r.playPredrop=function(e,t){var r=e.predroppable.current,o=!1;if(!r)return!1;t(r)&&s(e,{role:r.role,color:e.movable.color},r.key)&&(n(e.movable.events.afterNewPiece,r.role,r.key,{predrop:!0}),o=!0);return i(e),o},r.cancelMove=g,r.stop=function(e){e.movable.color=e.movable.dests=e.animation.current=void 0,g(e)},r.getKeyAtDomPos=function(e,t,r){var n=Math.ceil((e[0]-r.left)/r.width*8);t||(n=9-n);var o=Math.ceil(8-(e[1]-r.top)/r.height*8);return t||(o=9-o),n>0&&n<9&&o>0&&o<9?h.pos2key([n,o]):void 0}},{"./premove":12,"./util":17}],4:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("./api"),o=e("./config"),i=e("./state"),a=e("./wrap"),s=e("./events"),c=e("./render"),u=e("./svg"),l=e("./util");r.Chessground=function(e,t){function r(){var t=d.dom&&d.dom.unbind;e.classList.add("cg-board-wrap");var n=l.memo(function(){return e.getBoundingClientRect()}),o=d.viewOnly&&!d.drawable.visible,i=a.default(e,d,o?void 0:n()),f=function(e){c.default(d),!e&&i.svg&&u.renderSvg(d,i.svg)};d.dom={elements:i,bounds:n,redraw:function(e){var t=!1;return function(){t||(t=!0,l.raf(function(){e(),t=!1}))}}(f),redrawNow:f,unbind:t,relative:o},d.drawable.prevSvgHash="",f(!1),s.bindBoard(d),t||(d.dom.unbind=s.bindDocument(d,r))}var d=i.defaults();return o.configure(d,t||{}),r(),n.start(d,r)}},{"./api":2,"./config":5,"./events":8,"./render":13,"./state":14,"./svg":15,"./util":17,"./wrap":18}],5:[function(e,t,r){"use strict";function n(e,t){for(var r in t)o(e[r])&&o(t[r])?n(e[r],t[r]):e[r]=t[r]}function o(e){return"object"==typeof e}Object.defineProperty(r,"__esModule",{value:!0});var i=e("./board"),a=e("./fen");r.configure=function(e,t){if(t.movable&&t.movable.dests&&(e.movable.dests=void 0),n(e,t),t.fen&&(e.pieces=a.read(t.fen),e.drawable.shapes=[]),t.hasOwnProperty("check")&&i.setCheck(e,t.check||!1),t.hasOwnProperty("lastMove")&&!t.lastMove?e.lastMove=void 0:t.lastMove&&(e.lastMove=t.lastMove),e.selected&&i.setSelected(e,e.selected),(!e.animation.duration||e.animation.duration<100)&&(e.animation.enabled=!1),!e.movable.rookCastle&&e.movable.dests){var r="white"===e.movable.color?1:8,o="e"+r,s=e.movable.dests[o];if(!s||"king"!==e.pieces[o].role)return;e.movable.dests[o]=s.filter(function(e){return!(e==="a"+r&&-1!==s.indexOf("c"+r)||e==="h"+r&&-1!==s.indexOf("g"+r))})}}},{"./board":3,"./fen":10}],6:[function(e,t,r){"use strict";function n(e){u.raf(function(){var t=e.draggable.current;if(t){e.animation.current&&e.animation.current.plan.anims[t.orig]&&(e.animation.current=void 0);var r=e.pieces[t.orig];if(r&&u.samePiece(r,t.piece)){if(!t.started&&u.distanceSq(t.epos,t.rel)>=Math.pow(e.draggable.distance,2)&&(t.started=!0),t.started){if("function"==typeof t.element){var i=t.element();if(!i)return;t.element=i,t.element.cgDragging=!0,t.element.classList.add("dragging")}var a="white"===e.orientation,s=e.dom.bounds();t.pos=[t.epos[0]-t.rel[0],t.epos[1]-t.rel[1]];var c=u.posToTranslateAbs(s)(t.origPos,a);c[0]+=t.pos[0]+t.dec[0],c[1]+=t.pos[1]+t.dec[1],u.translateAbs(t.element,c)}}else o(e);n(e)}})}function o(e){var t=e.draggable.current;t&&(t.newPiece&&delete e.pieces[t.orig],e.draggable.current=void 0,c.unselect(e),i(e),e.dom.redraw())}function i(e){var t=e.dom.elements;t.ghost&&u.setVisible(t.ghost,!1)}function a(e,t,r){var n=u.key2pos(e);return t||(n[0]=9-n[0],n[1]=9-n[1]),{left:r.left+r.width*(n[0]-1)/8,top:r.top+r.height*(8-n[1])/8,width:r.width/8,height:r.height/8}}function s(e,t){for(var r=e.dom.elements.board.firstChild;r;){if(r.cgKey===t&&"PIECE"===r.tagName)return r;r=r.nextSibling}}Object.defineProperty(r,"__esModule",{value:!0});var c=e("./board"),u=e("./util"),l=e("./draw"),d=e("./anim");r.start=function(e,t){if(!(void 0!==t.button&&0!==t.button||t.touches&&t.touches.length>1)){t.preventDefault();var r="white"===e.orientation,o=e.dom.bounds(),i=u.eventPosition(t),f=c.getKeyAtDomPos(i,r,o);if(f){var p=e.pieces[f],v=e.selected;v||!e.drawable.enabled||!e.drawable.eraseOnClick&&p&&p.color===e.turnColor||l.clear(e);var g=!!e.premovable.current,h=!!e.predroppable.current;e.stats.ctrlKey=t.ctrlKey,e.selected&&c.canMove(e,e.selected,f)?d.anim(function(e){return c.selectSquare(e,f)},e):c.selectSquare(e,f);var b=e.selected===f,m=s(e,f);if(p&&m&&b&&c.isDraggable(e,f)){var y=a(f,r,o);e.draggable.current={orig:f,origPos:u.key2pos(f),piece:p,rel:i,epos:i,pos:[0,0],dec:e.draggable.centerPiece?[i[0]-(y.left+y.width/2),i[1]-(y.top+y.height/2)]:[0,0],started:e.draggable.autoDistance&&e.stats.dragged,element:m,previouslySelected:v,originTarget:t.target},m.cgDragging=!0,m.classList.add("dragging");var w=e.dom.elements.ghost;w&&(w.className="ghost "+p.color+" "+p.role,u.translateAbs(w,u.posToTranslateAbs(o)(u.key2pos(f),r)),u.setVisible(w,!0)),n(e)}else g&&c.unsetPremove(e),h&&c.unsetPredrop(e);e.dom.redraw()}}},r.dragNewPiece=function(e,t,r,o){e.pieces.a0=t,e.dom.redraw();var i=u.eventPosition(r),c="white"===e.orientation,l=e.dom.bounds(),d=a("a0",c,l),f=[(c?0:7)*d.width+l.left,(c?8:-1)*d.height+l.top];e.draggable.current={orig:"a0",origPos:u.key2pos("a0"),piece:t,rel:f,epos:i,pos:[i[0]-f[0],i[1]-f[1]],dec:[-d.width/2,-d.height/2],started:!0,element:function(){return s(e,"a0")},originTarget:r.target,newPiece:!0,force:o||!1},n(e)},r.move=function(e,t){e.draggable.current&&(!t.touches||t.touches.length<2)&&(e.draggable.current.epos=u.eventPosition(t))},r.end=function(e,t){var r=e.draggable.current;if(r)if("touchend"!==t.type||!r||r.originTarget===t.target||r.newPiece){c.unsetPremove(e),c.unsetPredrop(e);var n=u.eventPosition(t)||r.epos,o=c.getKeyAtDomPos(n,"white"===e.orientation,e.dom.bounds());o&&r.started?r.newPiece?c.dropNewPiece(e,r.orig,o,r.force):(e.stats.ctrlKey=t.ctrlKey,c.userMove(e,r.orig,o)&&(e.stats.dragged=!0)):r.newPiece?delete e.pieces[r.orig]:e.draggable.deleteOnDropOff&&(delete e.pieces[r.orig],c.callUserFunction(e.events.change)),!r||r.orig!==r.previouslySelected||r.orig!==o&&o?e.selectable.enabled||c.unselect(e):c.unselect(e),i(e),e.draggable.current=void 0,e.dom.redraw()}else e.draggable.current=void 0},r.cancel=o},{"./anim":1,"./board":3,"./draw":7,"./util":17}],7:[function(e,t,r){"use strict";function n(e){s.raf(function(){var t=e.drawable.current;if(t){var r=a.getKeyAtDomPos(t.pos,"white"===e.orientation,e.dom.bounds());r!==t.mouseSq&&(t.mouseSq=r,t.dest=r!==t.orig?r:void 0,e.dom.redrawNow()),n(e)}})}function o(e){e.drawable.current&&(e.drawable.current=void 0,e.dom.redraw())}function i(e){e.onChange&&e.onChange(e.shapes)}Object.defineProperty(r,"__esModule",{value:!0});var a=e("./board"),s=e("./util"),c=["green","red","blue","yellow"];r.start=function(e,t){if(!(t.touches&&t.touches.length>1)){t.stopPropagation(),t.preventDefault(),a.cancelMove(e);var r=s.eventPosition(t),o=a.getKeyAtDomPos(r,"white"===e.orientation,e.dom.bounds());o&&(e.drawable.current={orig:o,pos:r,brush:function(e){var t=e.shiftKey&&s.isRightButton(e)?1:0,r=e.altKey?2:0;return c[t+r]}(t)},n(e))}},r.processDraw=n,r.move=function(e,t){e.drawable.current&&(e.drawable.current.pos=s.eventPosition(t))},r.end=function(e){var t=e.drawable.current;t&&(t.mouseSq&&function(e,t){var r=function(e){return e.orig===t.orig&&e.dest===t.dest},n=e.shapes.filter(r)[0];n&&(e.shapes=e.shapes.filter(function(e){return function(t){return!e(t)}}(r))),n&&n.brush===t.brush||e.shapes.push(t),i(e)}(e.drawable,t),o(e))},r.cancel=o,r.clear=function(e){e.drawable.shapes.length&&(e.drawable.shapes=[],e.dom.redraw(),i(e.drawable))}},{"./board":3,"./util":17}],8:[function(e,t,r){"use strict";function n(e,t,r,n){return e.addEventListener(t,r,n),function(){return e.removeEventListener(t,r)}}function o(e,t,r){return function(n){n.shiftKey||s.isRightButton(n)?e.drawable.enabled&&r(e,n):e.viewOnly||t(e,n)}}Object.defineProperty(r,"__esModule",{value:!0});var i=e("./drag"),a=e("./draw"),s=e("./util");r.bindBoard=function(e){if(!e.viewOnly){var t=e.dom.elements.board,r=function(e){return function(t){e.draggable.current?i.cancel(e):e.drawable.current?a.cancel(e):t.shiftKey||s.isRightButton(t)?e.drawable.enabled&&a.start(e,t):e.viewOnly||i.start(e,t)}}(e);t.addEventListener("touchstart",r),t.addEventListener("mousedown",r),(e.disableContextMenu||e.drawable.enabled)&&t.addEventListener("contextmenu",function(e){return e.preventDefault()})}},r.bindDocument=function(e,t){var r=[];!e.dom.relative&&e.resizable&&r.push(n(document.body,"chessground.resize",function(){e.dom.bounds.clear(),s.raf(t)}));if(!e.viewOnly){var c=o(e,i.move,a.move),u=o(e,i.end,a.end);["touchmove","mousemove"].forEach(function(e){return r.push(n(document,e,c))}),["touchend","mouseup"].forEach(function(e){return r.push(n(document,e,u))});var l=function(){return e.dom.bounds.clear()};r.push(n(window,"scroll",l,{passive:!0})),r.push(n(window,"resize",l,{passive:!0}))}return function(){return r.forEach(function(e){return e()})}}},{"./drag":6,"./draw":7,"./util":17}],9:[function(e,t,r){"use strict";function n(e,t){e.exploding&&(t?e.exploding.stage=t:e.exploding=void 0,e.dom.redraw())}Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e,t){e.exploding={stage:1,keys:t},e.dom.redraw(),setTimeout(function(){n(e,2),setTimeout(function(){return n(e,void 0)},120)},120)}},{}],10:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("./util"),o=e("./types");r.initial="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR";var i={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},a={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};r.read=function(e){"start"===e&&(e=r.initial);for(var t={},o=8,a=0,s=0,c=e;s<c.length;s++){var u=c[s];switch(u){case" ":return t;case"/":if(0==--o)return t;a=0;break;case"~":t[n.pos2key([a,o])].promoted=!0;break;default:var l=u.charCodeAt(0);if(l<57)a+=l-48;else{++a;var d=u.toLowerCase();t[n.pos2key([a,o])]={role:i[d],color:u===d?"black":"white"}}}}return t},r.write=function(e){var t,r;return n.invRanks.map(function(i){return o.ranks.map(function(o){return(t=e[n.pos2key([o,i])])?(r=a[t.role],"white"===t.color?r.toUpperCase():r):"1"}).join("")}).join("/").replace(/1{2,}/g,function(e){return e.length.toString()})}},{"./types":16,"./util":17}],11:[function(e,t,r){t.exports=e("./chessground").Chessground},{"./chessground":4}],12:[function(e,t,r){"use strict";function n(e,t){return Math.abs(e-t)}Object.defineProperty(r,"__esModule",{value:!0});var o=e("./util"),i=function(e,t,r,o){var i=n(e,r),a=n(t,o);return 1===i&&2===a||2===i&&1===a},a=function(e,t,r,o){return n(e,r)===n(t,o)},s=function(e,t,r,n){return e===r||t===n},c=function(e,t,r,n){return a(e,t,r,n)||s(e,t,r,n)};r.default=function(e,t,r){var u,l=e[t],d=o.key2pos(t);switch(l.role){case"pawn":u=function(e){return function(t,r,o,i){return n(t,o)<2&&("white"===e?i===r+1||r<=2&&i===r+2&&t===o:i===r-1||r>=7&&i===r-2&&t===o)}}(l.color);break;case"knight":u=i;break;case"bishop":u=a;break;case"rook":u=s;break;case"queen":u=c;break;case"king":u=function(e,t,r){return function(i,a,s,c){return n(i,s)<2&&n(a,c)<2||r&&a===c&&a===("white"===e?1:8)&&(5===i&&(3===s||7===s)||o.containsX(t,s))}}(l.color,function(e,t){var r;return Object.keys(e).filter(function(n){return(r=e[n])&&r.color===t&&"rook"===r.role}).map(function(e){return o.key2pos(e)[0]})}(e,l.color),r)}return o.allKeys.map(o.key2pos).filter(function(e){return(d[0]!==e[0]||d[1]!==e[1])&&u(d[0],d[1],e[0],e[1])}).map(o.pos2key)}},{"./util":17}],13:[function(e,t,r){"use strict";function n(e,t){for(var r in t)e.dom.elements.board.removeChild(t[r])}function o(e,t){var r=2+8*(e[1]-1)+(8-e[0]);return t&&(r=67-r),r+""}function i(e){return e.color+" "+e.role}function a(e,t,r){e[t]?e[t]+=" "+r:e[t]=r}Object.defineProperty(r,"__esModule",{value:!0});var s=e("./util"),c=e("./util");r.default=function(e){var t,r,u,l,d,f,p,v,g,h,b,m="white"===e.orientation,y=e.dom.relative?c.posToTranslateRel:c.posToTranslateAbs(e.dom.bounds()),w=e.dom.relative?c.translateRel:c.translateAbs,k=e.dom.elements.board,P=e.pieces,M=e.animation.current,C=M?M.plan.anims:{},O=M?M.plan.fadings:{},x=e.draggable.current,_=function(e){var t,r,n={};if(e.lastMove&&e.highlight.lastMove)for(t in e.lastMove)a(n,e.lastMove[t],"last-move");if(e.check&&e.highlight.check&&a(n,e.check,"check"),e.selected&&(a(n,e.selected,"selected"),e.movable.showDests)){var o=e.movable.dests&&e.movable.dests[e.selected];if(o)for(t in o)r=o[t],a(n,r,"move-dest"+(e.pieces[r]?" oc":""));var i=e.premovable.dests;if(i)for(t in i)r=i[t],a(n,r,"premove-dest"+(e.pieces[r]?" oc":""))}var s=e.premovable.current;if(s)for(t in s)a(n,s[t],"current-premove");else e.predroppable.current&&a(n,e.predroppable.current.key,"current-premove");var c=e.exploding;if(c)for(t in c.keys)a(n,c.keys[t],"exploding"+c.stage);return n}(e),S={},E={},A={},K={},D=Object.keys(P);for(u=k.firstChild;u;){if(t=u.cgKey,"PIECE"===u.tagName)l=P[t],f=C[t],p=O[t],d=u.cgPiece,!u.cgDragging||x&&x.orig===t||(u.classList.remove("dragging"),w(u,y(s.key2pos(t),m)),u.cgDragging=!1),!p&&u.cgFading&&(u.cgFading=!1,u.classList.remove("fading")),l?(f&&u.cgAnimating&&d===i(l)?((B=s.key2pos(t))[0]+=f[2],B[1]+=f[3],u.classList.add("anim"),w(u,y(B,m))):u.cgAnimating&&(u.cgAnimating=!1,u.classList.remove("anim"),w(u,y(s.key2pos(t),m)),e.addPieceZIndex&&(u.style.zIndex=o(s.key2pos(t),m))),d!==i(l)||p&&u.cgFading?p&&d===i(p)?(u.classList.add("fading"),u.cgFading=!0):A[d]?A[d].push(u):A[d]=[u]:S[t]=!0):A[d]?A[d].push(u):A[d]=[u];else if("SQUARE"===u.tagName){var j=u.className;_[t]===j?E[t]=!0:K[j]?K[j].push(u):K[j]=[u]}u=u.nextSibling}for(var T in _)if(!E[T]){b=(h=K[_[T]])&&h.pop();var q=y(s.key2pos(T),m);if(b)b.cgKey=T,w(b,q);else{var N=s.createEl("square",_[T]);N.cgKey=T,w(N,q),k.insertBefore(N,k.firstChild)}}for(var L in D)if(t=D[L],r=P[t],f=C[t],!S[t])if(v=A[i(r)],g=v&&v.pop())g.cgKey=t,g.cgFading&&(g.classList.remove("fading"),g.cgFading=!1),B=s.key2pos(t),e.addPieceZIndex&&(g.style.zIndex=o(B,m)),f&&(g.cgAnimating=!0,g.classList.add("anim"),B[0]+=f[2],B[1]+=f[3]),w(g,y(B,m));else{var R=i(r),W=s.createEl("piece",R),B=s.key2pos(t);W.cgPiece=R,W.cgKey=t,f&&(W.cgAnimating=!0,B[0]+=f[2],B[1]+=f[3]),w(W,y(B,m)),e.addPieceZIndex&&(W.style.zIndex=o(B,m)),k.appendChild(W)}for(var F in A)n(e,A[F]);for(var F in K)n(e,K[F])}},{"./util":17}],14:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("./fen"),o=e("./util");r.defaults=function(){return{pieces:n.read(n.initial),orientation:"white",turnColor:"white",coordinates:!0,autoCastle:!0,viewOnly:!1,disableContextMenu:!1,resizable:!0,addPieceZIndex:!1,pieceKey:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,centerPiece:!0,showGhost:!0,deleteOnDropOff:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,eraseOnClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15}},pieces:{baseUrl:"https://lichess1.org/assets/piece/cburnett/"},prevSvgHash:""},hold:o.timer()}}},{"./fen":10,"./util":17}],15:[function(e,t,r){"use strict";function n(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function o(e,t,r){var n=e.orig,o=e.dest,i=e.brush,a=e.piece,s=e.modifiers;return[r,n,o,i,o&&t[o]>1,a&&function(e){return[e.color,e.role,e.scale].filter(function(e){return e}).join("")}(a),s&&function(e){return""+(e.lineWidth||"")}(s)].filter(function(e){return e}).join("")}function i(e,t){for(var r in t)e.setAttribute(r,t[r]);return e}function a(e,t){return"white"===t?e:[9-e[0],9-e[1]]}function s(e,t){var r={color:e.color,opacity:Math.round(10*e.opacity)/10,lineWidth:Math.round(t.lineWidth||e.lineWidth)};return r.key=[e.key,t.lineWidth].filter(function(e){return e}).join(""),r}function c(e,t){return(e.opacity||1)*(t?.9:1)}function u(e,t){return[(e[0]-.5)*t.width/8,(8.5-e[1])*t.height/8]}Object.defineProperty(r,"__esModule",{value:!0});var l=e("./util");r.createElement=n;var d;r.renderSvg=function(e,t){var r=e.drawable,f=r.current,p=f&&f.mouseSq?f:void 0,v={};r.shapes.concat(r.autoShapes).concat(p?[p]:[]).forEach(function(e){e.dest&&(v[e.dest]=(v[e.dest]||0)+1)});var g=r.shapes.concat(r.autoShapes).map(function(e){return{shape:e,current:!1,hash:o(e,v,!1)}});p&&g.push({shape:p,current:!0,hash:o(p,v,!0)});var h=g.map(function(e){return e.hash}).join("");if(h!==e.drawable.prevSvgHash){e.drawable.prevSvgHash=h;var b=t.firstChild;!function(e,t,r){var o,a={};g.forEach(function(t){t.shape.dest&&(o=e.brushes[t.shape.brush],t.shape.modifiers&&(o=s(o,t.shape.modifiers)),a[o.key]=o)});for(var c={},u=r.firstChild;u;)c[u.getAttribute("cgKey")]=!0,u=u.nextSibling;for(var l in a)c[l]||r.appendChild(function(e){var t=i(n("marker"),{id:"arrowhead-"+e.key,orient:"auto",markerWidth:4,markerHeight:8,refX:2.05,refY:2.01});return t.appendChild(i(n("path"),{d:"M0,0 V4 L3,2 Z",fill:e.color})),t.setAttribute("cgKey",e.key),t}(a[l]))}(r,0,b),function(e,t,r,o,f,p){void 0===d&&(d=l.computeIsTrident());var v=e.dom.bounds(),g={},h=[];t.forEach(function(e){g[e.hash]=!1});for(var b,m=p.nextSibling;m;)b=m.getAttribute("cgHash"),g.hasOwnProperty(b)?g[b]=!0:h.push(m),m=m.nextSibling;h.forEach(function(e){return f.removeChild(e)}),t.forEach(function(t){g[t.hash]||f.appendChild(function(e,t,r,o,f){var p,v=t.shape,g=t.current,h=t.hash;if(v.piece)p=function(e,t,r,o){var a=u(t,o),s=o.width/8*(r.scale||1),c=r.color[0]+("knight"===r.role?"n":r.role[0]).toUpperCase();return i(n("image"),{className:r.role+" "+r.color,x:a[0]-s/2,y:a[1]-s/2,width:s,height:s,href:e+c+".svg"})}(e.drawable.pieces.baseUrl,a(l.key2pos(v.orig),e.orientation),v.piece,f);else{var b=a(l.key2pos(v.orig),e.orientation);if(v.orig&&v.dest){var m=r[v.brush];v.modifiers&&(m=s(m,v.modifiers)),p=function(e,t,r,o,a,s){var l=d?0:(a&&!o?20:10)/512*s.width,f=u(t,s),p=u(r,s),v=p[0]-f[0],g=p[1]-f[1],h=Math.atan2(g,v),b=Math.cos(h)*l,m=Math.sin(h)*l;return i(n("line"),{stroke:e.color,"stroke-width":function(t,r,n){return(e.lineWidth||10)*(r?.85:1)/512*n.width}(0,o,s),"stroke-linecap":"round","marker-end":d?void 0:"url(#arrowhead-"+e.key+")",opacity:c(e,o),x1:f[0],y1:f[1],x2:p[0]-b,y2:p[1]-m})}(m,b,a(l.key2pos(v.dest),e.orientation),g,o[v.dest]>1,f)}else p=function(e,t,r,o){var a=u(b,o),s=function(e){var t=o.width/512;return[3*t,4*t]}(),l=(o.width+o.height)/32;return i(n("circle"),{stroke:e.color,"stroke-width":s[r?0:1],fill:"none",opacity:c(e,r),cx:a[0],cy:a[1],r:l-s[1]/2})}(r[v.brush],0,g,f)}return p.setAttribute("cgHash",h),p}(e,t,r,o,v))})}(e,g,r.brushes,v,t,b)}}},{"./util":17}],16:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.files=["a","b","c","d","e","f","g","h"],r.ranks=[1,2,3,4,5,6,7,8]},{}],17:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("./types");r.colors=["white","black"],r.invRanks=[8,7,6,5,4,3,2,1],r.allKeys=(i=Array.prototype).concat.apply(i,n.files.map(function(e){return n.ranks.map(function(t){return e+t})})),r.pos2key=function(e){return r.allKeys[8*e[0]+e[1]-9]},r.key2pos=function(e){return[e.charCodeAt(0)-96,e.charCodeAt(1)-48]},r.memo=function(e){var t,r=function(){return void 0===t&&(t=e()),t};return r.clear=function(){t=void 0},r},r.timer=function(){var e;return{start:function(){e=Date.now()},cancel:function(){e=void 0},stop:function(){if(!e)return 0;var t=Date.now()-e;return e=void 0,t}}},r.opposite=function(e){return"white"===e?"black":"white"},r.containsX=function(e,t){return void 0!==e&&-1!==e.indexOf(t)},r.distanceSq=function(e,t){return Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)},r.samePiece=function(e,t){return e.role===t.role&&e.color===t.color},r.computeIsTrident=function(){return window.navigator.userAgent.indexOf("Trident/")>-1};var o=function(e,t,r,n){return[(t?e[0]-1:8-e[0])*r,(t?8-e[1]:e[1]-1)*n]};r.posToTranslateAbs=function(e){var t=e.width/8,r=e.height/8;return function(e,n){return o(e,n,t,r)}},r.posToTranslateRel=function(e,t){return o(e,t,12.5,12.5)},r.translateAbs=function(e,t){e.style.transform="translate("+t[0]+"px,"+t[1]+"px)"},r.translateRel=function(e,t){e.style.left=t[0]+"%",e.style.top=t[1]+"%"},r.setVisible=function(e,t){e.style.visibility=t?"visible":"hidden"},r.eventPosition=function(e){return e.clientX||0===e.clientX?[e.clientX,e.clientY]:e.touches&&e.targetTouches[0]?[e.targetTouches[0].clientX,e.targetTouches[0].clientY]:void 0},r.isRightButton=function(e){return 2===e.buttons||2===e.button},r.createEl=function(e,t){var r=document.createElement(e);return t&&(r.className=t),r},r.raf=(window.requestAnimationFrame||window.setTimeout).bind(window);var i},{"./types":16}],18:[function(e,t,r){"use strict";function n(e,t){var r,n=o.createEl("coords",t);for(var i in e)(r=o.createEl("coord")).textContent=e[i],n.appendChild(r);return n}Object.defineProperty(r,"__esModule",{value:!0});var o=e("./util"),i=e("./types"),a=e("./svg");r.default=function(e,t,r){e.innerHTML="",e.classList.add("cg-board-wrap"),o.colors.forEach(function(r){e.classList.toggle("orientation-"+r,t.orientation===r)}),e.classList.toggle("manipulable",!t.viewOnly);var s=o.createEl("div","cg-board");e.appendChild(s);var c;if(t.drawable.visible&&r&&((c=a.createElement("svg")).appendChild(a.createElement("defs")),e.appendChild(c)),t.coordinates){var u="black"===t.orientation?" black":"";e.appendChild(n(i.ranks,"ranks"+u)),e.appendChild(n(i.files,"files"+u))}var l;return r&&t.draggable.showGhost&&(l=o.createEl("piece","ghost"),o.setVisible(l,!1),e.appendChild(l)),{board:s,ghost:l,svg:c}}},{"./svg":15,"./types":16,"./util":17}]},{},[11])(11)});